# FreePBX VoIP Platform - Log Rotation Configuration
# Place this file in /etc/logrotate.d/freepbx-voip-platform
# 
# This configuration manages log rotation for all cron job logs
# and application logs to prevent disk space issues

# Application Logs
/path/to/project/storage/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data www-data
    postrotate
        # Reload PHP-FPM to release file handles
        /usr/sbin/service php8.1-fpm reload > /dev/null 2>&1 || true
    endscript
}

# Cron Job Logs
/var/log/cron-*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    postrotate
        # Send HUP signal to rsyslog to reopen log files
        /usr/bin/killall -HUP rsyslogd > /dev/null 2>&1 || true
    endscript
}

# CDR Processing Logs (High volume, rotate more frequently)
/var/log/cron-cdr*.log {
    hourly
    rotate 48
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    size 100M
}

# Billing Logs (Critical, keep longer)
/var/log/cron-billing*.log {
    daily
    rotate 90
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# System Health Logs
/var/log/cron-health*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# Backup Logs (Keep for compliance)
/var/log/cron-backup*.log {
    weekly
    rotate 52
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# Performance and Monitoring Logs
/var/log/cron-monitor*.log /var/log/cron-reports*.log {
    weekly
    rotate 12
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# FreePBX Sync Logs
/var/log/cron-freepbx*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# Maintenance and Cleanup Logs
/var/log/cron-maintenance*.log /var/log/cron-cleanup*.log {
    weekly
    rotate 8
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# Security Audit Logs (Keep for compliance)
/var/log/cron-security*.log {
    monthly
    rotate 24
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# Queue Worker Logs (High volume)
/var/log/cron-queue*.log {
    hourly
    rotate 24
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    size 50M
}

# Payment Gateway Logs (Important for financial records)
/var/log/cron-payments*.log {
    daily
    rotate 365
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# CDR Sync Logs
/var/log/cron-cdr-sync*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# Cache and Performance Logs
/var/log/cron-cache*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}