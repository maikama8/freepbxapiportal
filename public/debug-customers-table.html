<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Customers Table</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h4>Debug Customers DataTable</h4>
                    </div>
                    <div class="card-body">
                        <div id="result"></div>
                        
                        <h5>Test DataTable</h5>
                        <table id="testTable" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Role</th>
                                    <th>Account Type</th>
                                    <th>Balance</th>
                                    <th>Status</th>
                                    <th>Extension</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        
                        <div class="mt-4">
                            <h6>Instructions:</h6>
                            <ol>
                                <li>Make sure you're logged in as admin in another tab</li>
                                <li>This will test the DataTable with the same configuration as the admin page</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            console.log('Initializing test DataTable...');
            
            const table = $('#testTable').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: '/admin/customers/data',
                    type: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    xhrFields: {
                        withCredentials: true
                    },
                    data: function(d) {
                        console.log('DataTable request data:', d);
                    },
                    error: function(xhr, error, code) {
                        console.error('DataTable AJAX Error:', {
                            status: xhr.status,
                            statusText: xhr.statusText,
                            responseText: xhr.responseText,
                            error: error,
                            code: code
                        });
                        
                        let errorMessage = 'Error loading data: ';
                        if (xhr.status === 401) {
                            errorMessage += 'Not authenticated. Please login as admin first.';
                        } else if (xhr.status === 403) {
                            errorMessage += 'Access denied. You may not have admin permissions.';
                        } else if (xhr.responseJSON?.message) {
                            errorMessage += xhr.responseJSON.message;
                        } else {
                            errorMessage += `HTTP ${xhr.status} - ${xhr.statusText}`;
                        }
                        
                        $('#result').html(`<div class="alert alert-danger">${errorMessage}</div>`);
                    },
                    success: function(data) {
                        console.log('DataTable success:', data);
                        $('#result').html(`<div class="alert alert-success">
                            DataTable loaded successfully!<br>
                            Total Records: ${data.recordsTotal}<br>
                            Filtered Records: ${data.recordsFiltered}<br>
                            Data Count: ${data.data.length}
                        </div>`);
                    }
                },
                columns: [
                    { data: 'id', name: 'id' },
                    { data: 'name', name: 'name' },
                    { data: 'email', name: 'email' },
                    { data: 'phone', name: 'phone' },
                    { data: 'role', name: 'role' },
                    { data: 'account_type', name: 'account_type' },
                    { data: 'balance', name: 'balance' },
                    { data: 'status', name: 'status' },
                    { data: 'extension', name: 'extension' },
                    { data: 'created_at', name: 'created_at' }
                ],
                order: [[0, 'desc']],
                pageLength: 25
            });
        });
    </script>
</body>
</html>